<!DOCTYPE html>
<html>
<head>
    <title>Label Maker</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js"></script>
</head>
<body>
	<style>
		#subtitle {
			font-size: 18px;
			justify-content: center;
			align-items: center;
			text-align: center;		
		}
	</style>
    <h1>Label Maker</h1>
    <form id="itemForm">
        <table>
            <tr>
                <th><label for="itemName">Item Name:</label></th>
                <th><input type="text" id="itemName" name="itemName" required></th>
            </tr>
            <tr>
                <th><label for="subtitle">Subtitle:</label></th>
                <th><input type="text" id="subtitleDetail" name="subtitle" required></th>
            </tr>
            <tr>
                <th><label for="vendorId">Vendor ID:</label></th>
                <th><input type="text" id="vendorId" name="vendorId" required></th>
            </tr>
            <tr>
                <th><label for="suffix">Suffix:</label></th>
                <th><input type="text" id="suffix" name="suffix" required></th>
            </tr>
            <tr>
                <th><label for="price">Price:</label></th>
                <th><input type="number" id="price" name="price" required><br></th>
            </tr>
            <tr>
                <th><label for="labelCount">Labels to Print:</label></th>
                <th><input type="number" id="labelCount" name="labelCount" value="1" required><br></th>
            </tr>            
        </table>
        <label>Tip: Omit decimals.  $4.50 should be entered as 450</label><br><br>      
        <input type="submit" onclick="generateLabel()" value="Generate Label">  
        <button onclick="printTable()">Print Label</button>
        <button onclick="clearData()">Clear</button>
        <br><br>
    </form>
    <table>
        <tr>
            <th><div id="output"></div></th>
        </tr>
        <tr>
            <th><svg id="barcode"></svg></th>
        </tr>
    </table>
    <script>
		document.getElementById("itemForm").addEventListener("submit", function(event) {
			event.preventDefault();
		});

        function generateLabel() {               
			var itemName = '<div style="font-size: x-large;justify-content: center;text-align: center;">' + document.getElementById("itemName").value + "</div>";
			var subtitle = document.getElementById("subtitleDetail").value;
			
			var price = document.getElementById("price").value;

		    var priceElement = '<div style="font-size: x-large;justify-content: center;align-items: full;text-align: center;">' + 
				document.getElementById("vendorId").value + "-" + document.getElementById("suffix").value + ": $" +
				(price/100).toFixed(2) + 
				"</div>";
			var vendorId = document.getElementById("vendorId").value;
			var suffix = document.getElementById("suffix").value;
		   
			if (subtitle == '') {
			
				var outputText = itemName + priceElement;
			} else {
				var outputText = itemName + "<div id=subtitle>" + subtitle + "</div>" + priceElement;
			}
			
			var barcodeText = vendorId + "-" + suffix + "-" + price;
		   
			document.getElementById("output").innerHTML = outputText;
		   
		   	JsBarcode("#barcode", barcodeText, {
				displayValue: false,
				height: 50,
				format: "CODE128"
			}); 
        }

        function printTable() {
			var printContents = "<table><tr><th>" +
                document.getElementById("output").innerHTML +
                "</th></tr><tr><th>" +
                document.getElementById("barcode").outerHTML +
                "</th></tr></table>";
            var originalContents = document.body.innerHTML;
            var labelCount = document.getElementById("labelCount").value;

            multipageContent = printContents.repeat(labelCount);
            document.body.innerHTML = multipageContent;
            window.print();
            document.body.innerHTML = originalContents;

            // Refresh the page
            location.reload();
        }

        function clearData() {
            document.getElementById("itemName").value = "";
			document.getElementById("subtitleDetail").value = "";
            document.getElementById("vendorId").value = "";
            document.getElementById("suffix").value = "";
            document.getElementById("price").value = "";
            document.getElementById("output").innerHTML = "";
            document.getElementById("barcode").innerHTML = "";
        }

        // Prepopulate inputs with URL parameters
        function getUrlParams() {
            var params = {};
            var search = window.location.search.substring(1);
            var pairs = search.split("&");
            for (var i = 0; i < pairs.length; i++) {
                var pair = pairs[i].split("=");
                if (pair[0]) {
                    params[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || "");
                }
            }
            return params;
        }

        function prepopulateInputs() {
            var params = getUrlParams();
            document.getElementById("itemName").value = params["itemName"] || "";
			document.getElementById("subtitleDetail").value = params["subtitle"] || "";
            document.getElementById("vendorId").value = params["vendorId"] || "";
            document.getElementById("suffix").value = params["suffix"] || "";
            document.getElementById("price").value = params["price"] || "";
			generateLabel()
        }

        prepopulateInputs();
    </script>
</body>
</html>